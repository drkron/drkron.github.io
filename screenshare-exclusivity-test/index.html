<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Share Exclusivity Test</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .video-box { background: #eee; padding: 10px; border-radius: 8px; border: 2px solid #ddd; }
        video { width: 100%; height: 200px; background: #000; margin-top: 10px; }
        
        button { 
            padding: 15px 25px; font-size: 16px; cursor: pointer; 
            background: #007bff; color: white; border: none; border-radius: 4px;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }

        .status { font-weight: bold; margin-bottom: 5px; font-family: monospace; }
        .live { color: green; }
        .ended { color: red; background: #ffe6e6; padding: 2px 5px; }

        #log { 
            margin-top: 30px; background: #222; color: #0f0; 
            padding: 15px; height: 250px; overflow-y: scroll; 
            font-family: monospace; border-radius: 4px;
        }
    </style>
</head>
<body>

    <h2>Test: Does the OS kill Stream A when Stream B starts?</h2>

    <div>
        <button onclick="startStream('A')">1. Start Stream A</button>
        <button onclick="startStream('B')">2. Start Stream B</button>
    </div>

    <div class="grid">
        <div class="video-box">
            <h3>Stream A</h3>
            <div id="status-A" class="status">Status: Idle</div>
            <video id="video-A" autoplay playsinline muted></video>
        </div>

        <div class="video-box">
            <h3>Stream B</h3>
            <div id="status-B" class="status">Status: Idle</div>
            <video id="video-B" autoplay playsinline muted></video>
        </div>
    </div>

    <div id="log"></div>

    <script>
        function log(msg) {
            const div = document.getElementById('log');
            const time = new Date().toISOString().split('T')[1].slice(0, -1);
            div.innerHTML += `[${time}] ${msg}<br>`;
            div.scrollTop = div.scrollHeight;
            console.log(msg);
        }

        function setStatus(id, state) {
            const el = document.getElementById(`status-${id}`);
            el.innerText = `Status: ${state}`;
            el.className = `status ${state.toLowerCase()}`;
        }

        async function startStream(id) {
            try {
                log(`üöÄ Requesting <b>Stream ${id}</b>...`);
                
                // Request the screen share
                const stream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: { width: 640, height: 480 } 
                });
                const track = stream.getVideoTracks()[0];

                log(`‚úÖ <b>Stream ${id} STARTED</b> (Track ID: ${track.id.substring(0,8)}...)`);
                
                // Play it in the UI
                const video = document.getElementById(`video-${id}`);
                video.srcObject = stream;
                setStatus(id, "LIVE");

                // --- THE CRITICAL TEST ---
                // Listen for when the browser/OS kills this track
                track.addEventListener('ended', () => {
                    log(`üíÄ <b>Stream ${id} ENDED</b> (Event fired by Browser/OS)`);
                    setStatus(id, "ENDED");
                    video.style.opacity = "0.5";
                });

            } catch (err) {
                log(`‚ùå Error starting Stream ${id}: ${err.name} - ${err.message}`);
            }
        }
    </script>
</body>
</html>

